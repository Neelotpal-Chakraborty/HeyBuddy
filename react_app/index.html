<!DOCTYPE html>
<html lang="en" data-theme="light" data-lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeyBuddy - Your Mental Health Companion</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Bengali:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --accent: #10b981;
            --danger: #ef4444;
            --gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        /* Light Theme */
        [data-theme="light"] {
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-secondary: #f1f5f9;
            --surface-tertiary: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --bot-message-bg: #f1f5f9;
            --input-bg: #f8fafc;
            --modal-overlay: rgba(0, 0, 0, 0.5);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --background: #0f172a;
            --surface: #1e293b;
            --surface-secondary: #334155;
            --surface-tertiary: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-light: #64748b;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
            --bot-message-bg: #334155;
            --input-bg: #334155;
            --modal-overlay: rgba(0, 0, 0, 0.7);
        }

        /* Sepia Theme */
        [data-theme="sepia"] {
            --background: #faf6f0;
            --surface: #fffcf7;
            --surface-secondary: #f5ede0;
            --surface-tertiary: #e8dcc8;
            --text-primary: #3d3630;
            --text-secondary: #6b6259;
            --text-light: #9a9085;
            --border: #e0d8c9;
            --shadow: 0 4px 6px -1px rgba(61, 54, 48, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(61, 54, 48, 0.1);
            --bot-message-bg: #f5ede0;
            --input-bg: #f5ede0;
            --modal-overlay: rgba(61, 54, 48, 0.5);
            --primary: #b8860b;
            --primary-light: #daa520;
            --gradient: linear-gradient(135deg, #b8860b 0%, #daa520 100%);
        }

        /* Ocean Theme */
        [data-theme="ocean"] {
            --background: #ecfeff;
            --surface: #ffffff;
            --surface-secondary: #cffafe;
            --surface-tertiary: #a5f3fc;
            --text-primary: #164e63;
            --text-secondary: #0e7490;
            --text-light: #06b6d4;
            --border: #a5f3fc;
            --shadow: 0 4px 6px -1px rgba(22, 78, 99, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(22, 78, 99, 0.1);
            --bot-message-bg: #cffafe;
            --input-bg: #cffafe;
            --modal-overlay: rgba(22, 78, 99, 0.5);
            --primary: #0891b2;
            --primary-light: #22d3ee;
            --gradient: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
        }

        /* Forest Theme */
        [data-theme="forest"] {
            --background: #f0fdf4;
            --surface: #ffffff;
            --surface-secondary: #dcfce7;
            --surface-tertiary: #bbf7d0;
            --text-primary: #14532d;
            --text-secondary: #166534;
            --text-light: #22c55e;
            --border: #bbf7d0;
            --shadow: 0 4px 6px -1px rgba(20, 83, 45, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(20, 83, 45, 0.1);
            --bot-message-bg: #dcfce7;
            --input-bg: #dcfce7;
            --modal-overlay: rgba(20, 83, 45, 0.5);
            --primary: #16a34a;
            --primary-light: #22c55e;
            --gradient: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
        }

        /* Sunset Theme */
        [data-theme="sunset"] {
            --background: #fff7ed;
            --surface: #ffffff;
            --surface-secondary: #ffedd5;
            --surface-tertiary: #fed7aa;
            --text-primary: #7c2d12;
            --text-secondary: #c2410c;
            --text-light: #f97316;
            --border: #fed7aa;
            --shadow: 0 4px 6px -1px rgba(124, 45, 18, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(124, 45, 18, 0.1);
            --bot-message-bg: #ffedd5;
            --input-bg: #ffedd5;
            --modal-overlay: rgba(124, 45, 18, 0.5);
            --primary: #ea580c;
            --primary-light: #f97316;
            --gradient: linear-gradient(135deg, #ea580c 0%, #f97316 100%);
        }

        body {
            font-family: 'Inter', 'Noto Sans Devanagari', 'Noto Sans Bengali', sans-serif;
            background: var(--background);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        [data-lang="bn"] { font-family: 'Noto Sans Bengali', 'Inter', sans-serif; }
        [data-lang="hi"], [data-lang="mr"] { font-family: 'Noto Sans Devanagari', 'Inter', sans-serif; }

        /* Header */
        .header {
            background: var(--surface);
            padding: 0.75rem 1.5rem;
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .logo-text h1 {
            font-size: 1.6rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text span {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: block;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-btn {
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 0.875rem;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .header-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .helpline-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            text-decoration: none;
            animation: glowPulse 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
        }

        .helpline-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .helpline-btn .number {
            font-weight: 700;
            font-size: 1rem;
        }

        .emergency-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .emergency-btn:hover {
            transform: translateY(-2px);
        }

        /* Dropdown */
        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .dropdown.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            padding: 0.75rem 1rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--text-light);
            background: var(--surface-secondary);
            font-weight: 700;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        .dropdown-item:hover {
            background: var(--surface-secondary);
        }

        .dropdown-item.active {
            background: var(--primary);
            color: white;
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border);
        }

        .theme-preview {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
        }

        .theme-preview.light { background: linear-gradient(135deg, #fff 50%, #f1f5f9 50%); }
        .theme-preview.dark { background: linear-gradient(135deg, #1e293b 50%, #0f172a 50%); }
        .theme-preview.sepia { background: linear-gradient(135deg, #fffcf7 50%, #daa520 50%); }
        .theme-preview.ocean { background: linear-gradient(135deg, #ecfeff 50%, #0891b2 50%); }
        .theme-preview.forest { background: linear-gradient(135deg, #f0fdf4 50%, #16a34a 50%); }
        .theme-preview.sunset { background: linear-gradient(135deg, #fff7ed 50%, #ea580c 50%); }
        .theme-preview.auto { background: linear-gradient(135deg, #fff 50%, #0f172a 50%); }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 85px 1rem 1.5rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: sticky;
            top: 85px;
            height: fit-content;
        }

        .sidebar-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: var(--shadow);
        }

        .sidebar-card h3 {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-card h3 i {
            color: var(--primary);
        }

        /* Helpline Card */
        .helpline-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            text-align: center;
            padding: 1.5rem;
        }

        .helpline-card h3 {
            color: rgba(255,255,255,0.9);
            justify-content: center;
        }

        .helpline-card h3 i {
            color: white;
        }

        .helpline-card .helpline-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .helpline-card .helpline-number a {
            color: white;
            text-decoration: none;
        }

        .helpline-card p {
            font-size: 0.9rem;
            opacity: 0.95;
        }

        .helpline-card .call-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: white;
            color: #059669;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .helpline-card .call-btn:hover {
            transform: scale(1.05);
        }

        /* Mood Options */
        .mood-options {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
        }

        .mood-btn {
            flex: 1;
            aspect-ratio: 1;
            max-width: 50px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--surface);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mood-btn:hover, .mood-btn.active {
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .mood-btn.active {
            background: var(--primary);
        }

        /* Topic Buttons */
        .topic-btn {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--surface);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: var(--text-primary);
            gap: 0.75rem;
        }

        .topic-btn:last-child {
            margin-bottom: 0;
        }

        .topic-btn:hover {
            background: var(--surface-secondary);
            transform: translateX(4px);
        }

        .topic-btn i {
            color: var(--primary);
            width: 20px;
        }

        /* Resources Card */
        .resources-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        .resources-card h3 {
            color: rgba(255,255,255,0.9);
        }

        .resources-card h3 i {
            color: white;
        }

        .resources-card p {
            font-size: 0.85rem;
            line-height: 1.6;
            opacity: 0.95;
        }

        /* Chat Container */
        .chat-container {
            background: var(--surface);
            border-radius: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px);
            overflow: hidden;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }

        .status-avatar {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            position: relative;
        }

        .status-avatar::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--accent);
            border-radius: 50%;
            border: 2px solid var(--surface);
        }

        .status-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .status-info span {
            font-size: 0.8rem;
            color: var(--accent);
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--surface);
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-action-btn:hover {
            background: var(--surface-secondary);
            color: var(--primary);
        }

        /* Messages */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            max-width: 80%;
            animation: messageIn 0.3s ease;
        }

        @keyframes messageIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: var(--gradient);
            color: white;
        }

        .message.user .message-avatar {
            background: var(--surface-secondary);
            color: var(--primary);
        }

        .message-content {
            padding: 1rem 1.25rem;
            border-radius: 20px;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .message.bot .message-content {
            background: var(--bot-message-bg);
            border-bottom-left-radius: 6px;
        }

        .message.user .message-content {
            background: var(--gradient);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--text-light);
            margin-top: 0.25rem;
            padding: 0 0.25rem;
        }

        .message.user .message-time {
            text-align: right;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 0.75rem;
        }

        .typing-indicator .dots {
            display: flex;
            gap: 5px;
            padding: 1rem 1.5rem;
            background: var(--bot-message-bg);
            border-radius: 20px;
        }

        .typing-indicator .dot {
            width: 10px;
            height: 10px;
            background: var(--text-light);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-indicator .dot:nth-child(1) { animation-delay: 0s; }
        .typing-indicator .dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Suggestions */
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.5rem 1.5rem 1rem;
        }

        .suggestion-chip {
            padding: 0.6rem 1.1rem;
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: 50px;
            font-size: 0.85rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .suggestion-chip:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Input Area */
        .input-container {
            padding: 1rem 1.5rem 1.25rem;
            border-top: 1px solid var(--border);
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--input-bg);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 0.5rem 0.5rem 0.5rem 1rem;
            transition: all 0.3s ease;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .input-wrapper input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.75rem 0;
            font-size: 1rem;
            color: var(--text-primary);
            font-family: inherit;
        }

        .input-wrapper input::placeholder {
            color: var(--text-light);
        }

        .input-wrapper input:focus {
            outline: none;
        }

        .input-actions {
            display: flex;
            gap: 0.375rem;
        }

        .input-btn {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 12px;
            background: transparent;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .input-btn:hover {
            background: var(--surface-secondary);
            color: var(--primary);
        }

        .send-btn {
            background: var(--gradient);
            color: white;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .welcome-icon {
            width: 100px;
            height: 100px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            color: white;
            font-size: 3rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .welcome-screen h2 {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .welcome-screen > p {
            color: var(--text-secondary);
            max-width: 450px;
            margin: 0 auto 1.5rem;
            line-height: 1.7;
        }

        .welcome-helpline {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .welcome-helpline i {
            font-size: 1.5rem;
        }

        .welcome-helpline .helpline-info .number {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .welcome-helpline .helpline-info .text {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .welcome-features {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .welcome-feature {
            padding: 1.25rem 1.5rem;
            background: var(--surface-secondary);
            border-radius: 16px;
            min-width: 140px;
        }

        .welcome-feature i {
            font-size: 1.75rem;
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .welcome-feature p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 1rem;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--surface);
            border-radius: 24px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            transform: scale(0.9);
            transition: all 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .modal-header i {
            font-size: 1.5rem;
        }

        .modal-header.emergency i {
            color: #ef4444;
        }

        .modal-header h2 {
            font-size: 1.35rem;
            font-weight: 700;
        }

        .modal p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .primary-helpline {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .primary-helpline h4 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .primary-helpline .big-number {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .primary-helpline .big-number a {
            color: white;
            text-decoration: none;
        }

        .primary-helpline p {
            color: rgba(255,255,255,0.9);
            margin-bottom: 1rem;
        }

        .primary-helpline .call-now-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 2rem;
            background: white;
            color: #059669;
            border-radius: 50px;
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .primary-helpline .call-now-btn:hover {
            transform: scale(1.05);
        }

        .helpline-item {
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .helpline-item h4 {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .helpline-item a {
            color: var(--primary);
            font-size: 1.25rem;
            font-weight: 700;
            text-decoration: none;
        }

        .modal-btn {
            width: 100%;
            padding: 1rem;
            background: var(--surface-secondary);
            border: none;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .modal-btn:hover {
            background: var(--surface-tertiary);
        }

        .modal-btn.primary {
            background: var(--gradient);
            color: white;
        }

        .modal-btn.primary:hover {
            opacity: 0.9;
        }

        /* Settings */
        .settings-section {
            margin-bottom: 1.5rem;
        }

        .settings-section h4 {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .theme-option {
            padding: 1rem;
            background: var(--surface-secondary);
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .theme-option:hover {
            border-color: var(--primary-light);
        }

        .theme-option.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .theme-option .icon {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .theme-option .label {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .lang-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .lang-option {
            padding: 1rem;
            background: var(--surface-secondary);
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
        }

        .lang-option:hover {
            border-color: var(--primary-light);
        }

        .lang-option.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .lang-option .flag {
            font-size: 1.5rem;
        }

        .lang-option .lang-name {
            font-weight: 600;
        }

        .lang-option .lang-native {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Breathing Exercise */
        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: var(--gradient);
            margin: 2rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            font-weight: 600;
            transition: transform 4s ease-in-out;
        }

        .breathing-circle.inhale { transform: scale(1.3); }
        .breathing-circle.hold { transform: scale(1.3); }
        .breathing-circle.exhale { transform: scale(0.8); }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 1rem 1.5rem;
            border-radius: 14px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s ease;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success { border-left: 4px solid var(--accent); }
        .toast.success i { color: var(--accent); }

        /* Responsive */
        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
                padding-top: 80px;
            }

            .sidebar {
                display: none;
            }

            .chat-container {
                height: calc(100vh - 95px);
            }
        }

        @media (max-width: 600px) {
            .header { padding: 0.5rem 1rem; }
            .logo-text span { display: none; }
            .logo-text h1 { font-size: 1.3rem; }
            .logo-icon { width: 40px; height: 40px; font-size: 1.2rem; }
            .header-btn span { display: none; }
            .header-btn { padding: 0.5rem; }
            .helpline-btn span:not(.number) { display: none; }
            .emergency-btn span { display: none; }
            .emergency-btn { padding: 0.5rem 0.75rem; }
            .welcome-features { flex-direction: column; align-items: center; }
            .welcome-helpline { flex-direction: column; text-align: center; }
            .theme-grid { grid-template-columns: repeat(2, 1fr); }
            .lang-grid { grid-template-columns: 1fr; }
            .modal { padding: 1.5rem; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo" onclick="location.reload()">
                <div class="logo-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <div class="logo-text">
                    <h1>HeyBuddy</h1>
                    <span id="taglineText">Your Mental Health Companion</span>
                </div>
            </div>
            
            <div class="header-actions">
                <!-- Language Dropdown -->
                <div class="dropdown" id="langDropdown">
                    <button class="header-btn" onclick="toggleDropdown('langDropdown')">
                        <span id="currentLangFlag">üá¨üáß</span>
                        <span id="currentLangText">EN</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-header">Select Language</div>
                        <div class="dropdown-item active" data-lang="en" onclick="changeLanguage('en')">
                            <span>üá¨üáß</span>
                            <span>English</span>
                        </div>
                        <div class="dropdown-item" data-lang="hi" onclick="changeLanguage('hi')">
                            <span>üáÆüá≥</span>
                            <span>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</span>
                        </div>
                        <div class="dropdown-item" data-lang="bn" onclick="changeLanguage('bn')">
                            <span>üáÆüá≥</span>
                            <span>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</span>
                        </div>
                    </div>
                </div>

                <!-- Theme Dropdown -->
                <div class="dropdown" id="themeDropdown">
                    <button class="header-btn" onclick="toggleDropdown('themeDropdown')">
                        <i class="fas fa-palette"></i>
                        <span>Theme</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-header">Select Theme</div>
                        <div class="dropdown-item" data-theme="auto" onclick="changeTheme('auto')">
                            <div class="theme-preview auto"></div>
                            <span>Auto</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item active" data-theme="light" onclick="changeTheme('light')">
                            <div class="theme-preview light"></div>
                            <span>Light</span>
                        </div>
                        <div class="dropdown-item" data-theme="dark" onclick="changeTheme('dark')">
                            <div class="theme-preview dark"></div>
                            <span>Dark</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" data-theme="sepia" onclick="changeTheme('sepia')">
                            <div class="theme-preview sepia"></div>
                            <span>Sepia</span>
                        </div>
                        <div class="dropdown-item" data-theme="ocean" onclick="changeTheme('ocean')">
                            <div class="theme-preview ocean"></div>
                            <span>Ocean</span>
                        </div>
                        <div class="dropdown-item" data-theme="forest" onclick="changeTheme('forest')">
                            <div class="theme-preview forest"></div>
                            <span>Forest</span>
                        </div>
                        <div class="dropdown-item" data-theme="sunset" onclick="changeTheme('sunset')">
                            <div class="theme-preview sunset"></div>
                            <span>Sunset</span>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <button class="header-btn" onclick="showSettingsModal()">
                    <i class="fas fa-cog"></i>
                </button>

                <!-- Helpline Button -->
                <a href="tel:14416" class="helpline-btn">
                    <i class="fas fa-phone-alt"></i>
                    <span>Call</span>
                    <span class="number">14416</span>
                </a>

                <!-- Emergency Button -->
                <button class="emergency-btn" onclick="showEmergencyModal()">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Crisis Help</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main -->
    <main class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Helpline Card -->
            <div class="sidebar-card helpline-card">
                <h3><i class="fas fa-phone-alt"></i> Need to Talk?</h3>
                <div class="helpline-number">
                    <a href="tel:14416">14416</a>
                </div>
                <p>Connect with a counsellor. We're here to listen, 24/7.</p>
                <a href="tel:14416" class="call-btn">
                    <i class="fas fa-phone"></i>
                    Call Now
                </a>
            </div>

            <!-- Mood Tracker -->
            <div class="sidebar-card">
                <h3><i class="fas fa-smile"></i> How are you feeling?</h3>
                <div class="mood-options">
                    <button class="mood-btn" onclick="selectMood('üò¢', 'verySad')">üò¢</button>
                    <button class="mood-btn" onclick="selectMood('üòî', 'sad')">üòî</button>
                    <button class="mood-btn" onclick="selectMood('üòê', 'neutral')">üòê</button>
                    <button class="mood-btn" onclick="selectMood('üôÇ', 'good')">üôÇ</button>
                    <button class="mood-btn" onclick="selectMood('üòä', 'great')">üòä</button>
                </div>
            </div>

            <!-- Quick Topics -->
            <div class="sidebar-card">
                <h3><i class="fas fa-bolt"></i> Quick Topics</h3>
                <button class="topic-btn" onclick="quickTopic('anxiety')">
                    <i class="fas fa-wind"></i> Anxiety Relief
                </button>
                <button class="topic-btn" onclick="quickTopic('depression')">
                    <i class="fas fa-cloud-rain"></i> Feeling Down
                </button>
                <button class="topic-btn" onclick="quickTopic('sleep')">
                    <i class="fas fa-moon"></i> Sleep Issues
                </button>
                <button class="topic-btn" onclick="quickTopic('stress')">
                    <i class="fas fa-brain"></i> Stress Management
                </button>
                <button class="topic-btn" onclick="startBreathingExercise()">
                    <i class="fas fa-lungs"></i> Breathing Exercise
                </button>
            </div>

            <!-- Resources -->
            <div class="sidebar-card resources-card">
                <h3><i class="fas fa-heart"></i> Remember</h3>
                <p>HeyBuddy provides support but doesn't replace professional help. If you're in crisis, call 14416.</p>
            </div>
        </aside>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-status">
                    <div class="status-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="status-info">
                        <h3>Buddy</h3>
                        <span>Always here for you</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="chat-action-btn" onclick="clearChat()" title="Clear Chat">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">
                        <i class="fas fa-hand-holding-heart"></i>
                    </div>
                    <h2>Hey Buddy! üëã</h2>
                    <p>I'm here to listen and support you through difficult moments. Remember, you're not alone, and it's perfectly okay to ask for help.</p>
                    
                    <div class="welcome-helpline">
                        <i class="fas fa-phone-alt"></i>
                        <div class="helpline-info">
                            <div class="number">14416</div>
                            <div class="text">Talk to a counsellor anytime</div>
                        </div>
                    </div>

                    <div class="welcome-features">
                        <div class="welcome-feature">
                            <i class="fas fa-shield-heart"></i>
                            <p>Safe Space</p>
                        </div>
                        <div class="welcome-feature">
                            <i class="fas fa-lock"></i>
                            <p>Private & Secure</p>
                        </div>
                        <div class="welcome-feature">
                            <i class="fas fa-clock"></i>
                            <p>24/7 Available</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="suggestions" id="suggestions">
                <button class="suggestion-chip" onclick="sendSuggestion('I\\'m feeling anxious')">I'm feeling anxious</button>
                <button class="suggestion-chip" onclick="sendSuggestion('I need someone to talk to')">I need to talk</button>
                <button class="suggestion-chip" onclick="sendSuggestion('Help me calm down')">Help me calm down</button>
                <button class="suggestion-chip" onclick="sendSuggestion('I can\\'t sleep')">I can't sleep</button>
            </div>

            <div class="input-container">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Type your message here... I'm listening üíú"
                        onkeypress="handleKeyPress(event)"
                        autocomplete="off"
                    >
                    <div class="input-actions">
                        <button class="input-btn" onclick="startBreathingExercise()" title="Breathing Exercise">
                            <i class="fas fa-wind"></i>
                        </button>
                        <button class="input-btn send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Emergency Modal -->
    <div class="modal-overlay" id="emergencyModal" onclick="closeModalOnOverlay(event, 'emergencyModal')">
        <div class="modal">
            <div class="modal-header emergency">
                <i class="fas fa-exclamation-triangle"></i>
                <h2>Crisis Resources</h2>
            </div>
            <p>If you're having thoughts of self-harm or suicide, please reach out for immediate help. You matter, and people care about you.</p>
            
            <div class="primary-helpline">
                <h4><i class="fas fa-headset"></i> iCall Helpline</h4>
                <div class="big-number">
                    <a href="tel:14416">14416</a>
                </div>
                <p>Connect with a counsellor. We're here to listen.</p>
                <a href="tel:14416" class="call-now-btn">
                    <i class="fas fa-phone"></i>
                    Call Now
                </a>
            </div>

            <div class="helpline-item">
                <h4><i class="fas fa-phone"></i> Vandrevala Foundation</h4>
                <a href="tel:18602662345">1860-2662-345</a>
            </div>

            <div class="helpline-item">
                <h4><i class="fas fa-phone"></i> NIMHANS</h4>
                <a href="tel:08046110007">080-46110007</a>
            </div>
            
            <button class="modal-btn" onclick="closeEmergencyModal()">I understand</button>
        </div>
    </div>

    <!-- Breathing Modal -->
    <div class="modal-overlay" id="breathingModal" onclick="closeModalOnOverlay(event, 'breathingModal')">
        <div class="modal" style="text-align: center;">
            <div class="modal-header" style="justify-content: center;">
                <i class="fas fa-wind" style="color: var(--primary);"></i>
                <h2>Breathing Exercise</h2>
            </div>
            <p>Follow the circle to regulate your breathing and calm your mind.</p>
            
            <div class="breathing-circle" id="breathingCircle">Ready</div>
            
            <button class="modal-btn primary" onclick="toggleBreathingExercise()" id="breathingBtn">Start Exercise</button>
            <button class="modal-btn" onclick="closeBreathingModal()" style="margin-top: 0.75rem;">Close</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal" onclick="closeModalOnOverlay(event, 'settingsModal')">
        <div class="modal">
            <div class="modal-header">
                <i class="fas fa-cog" style="color: var(--primary);"></i>
                <h2>Settings</h2>
            </div>
            
            <div class="settings-section">
                <h4>Theme</h4>
                <div class="theme-grid">
                    <div class="theme-option" data-theme="auto" onclick="changeTheme('auto')">
                        <div class="icon">üåì</div>
                        <div class="label">Auto</div>
                    </div>
                    <div class="theme-option active" data-theme="light" onclick="changeTheme('light')">
                        <div class="icon">‚òÄÔ∏è</div>
                        <div class="label">Light</div>
                    </div>
                    <div class="theme-option" data-theme="dark" onclick="changeTheme('dark')">
                        <div class="icon">üåô</div>
                        <div class="label">Dark</div>
                    </div>
                    <div class="theme-option" data-theme="sepia" onclick="changeTheme('sepia')">
                        <div class="icon">üìú</div>
                        <div class="label">Sepia</div>
                    </div>
                    <div class="theme-option" data-theme="ocean" onclick="changeTheme('ocean')">
                        <div class="icon">üåä</div>
                        <div class="label">Ocean</div>
                    </div>
                    <div class="theme-option" data-theme="forest" onclick="changeTheme('forest')">
                        <div class="icon">üå≤</div>
                        <div class="label">Forest</div>
                    </div>
                    <div class="theme-option" data-theme="sunset" onclick="changeTheme('sunset')">
                        <div class="icon">üåÖ</div>
                        <div class="label">Sunset</div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h4>Language</h4>
                <div class="lang-grid">
                    <div class="lang-option active" data-lang="en" onclick="changeLanguage('en')">
                        <span class="flag">üá¨üáß</span>
                        <div>
                            <div class="lang-name">English</div>
                            <div class="lang-native">English</div>
                        </div>
                    </div>
                    <div class="lang-option" data-lang="hi" onclick="changeLanguage('hi')">
                        <span class="flag">üáÆüá≥</span>
                        <div>
                            <div class="lang-name">Hindi</div>
                            <div class="lang-native">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</div>
                        </div>
                    </div>
                    <div class="lang-option" data-lang="bn" onclick="changeLanguage('bn')">
                        <span class="flag">üáÆüá≥</span>
                        <div>
                            <div class="lang-name">Bengali</div>
                            <div class="lang-native">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="modal-btn primary" onclick="closeSettingsModal()">Save & Close</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Settings saved!</span>
    </div>

    <script>
        // ==========================================
        // STATE
        // ==========================================
        let currentLanguage = localStorage.getItem('heybuddy-lang') || 'en';
        let currentTheme = localStorage.getItem('heybuddy-theme') || 'light';
        let isTyping = false;
        let breathingInterval = null;
        let isBreathing = false;

        // ==========================================
        // TRANSLATIONS
        // ==========================================
        const translations = {
            en: {
                tagline: "Your Mental Health Companion",
                langCode: "EN",
                placeholder: "Type your message here... I'm listening üíú",
                moodVerySad: "I'm feeling really down and sad today üò¢",
                moodSad: "I'm not feeling great, kind of sad üòî",
                moodNeutral: "I'm feeling okay, not great not terrible üòê",
                moodGood: "I'm feeling pretty good today üôÇ",
                moodGreat: "I'm actually feeling really good! üòä",
                topicAnxiety: "I'm struggling with anxiety and would like some help",
                topicDepression: "I've been feeling depressed and need support",
                topicSleep: "I'm having trouble sleeping and it's affecting me",
                topicStress: "I'm feeling really stressed out"
            },
            hi: {
                tagline: "‡§Ü‡§™‡§ï‡§æ ‡§Æ‡§æ‡§®‡§∏‡§ø‡§ï ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§æ‡§•‡•Ä",
                langCode: "‡§π‡§ø‡§Ç",
                placeholder: "‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç... ‡§Æ‡•à‡§Ç ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å üíú",
                moodVerySad: "‡§Æ‡•à‡§Ç ‡§Ü‡§ú ‡§¨‡§π‡•Å‡§§ ‡§â‡§¶‡§æ‡§∏ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡§æ/‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å üò¢",
                moodSad: "‡§Æ‡•à‡§Ç ‡§†‡•Ä‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Ç‡§Å, ‡§•‡•ã‡§°‡§º‡§æ ‡§â‡§¶‡§æ‡§∏ ‡§π‡•Ç‡§Å üòî",
                moodNeutral: "‡§Æ‡•à‡§Ç ‡§†‡•Ä‡§ï-‡§†‡§æ‡§ï ‡§π‡•Ç‡§Å üòê",
                moodGood: "‡§Æ‡•à‡§Ç ‡§Ü‡§ú ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡§æ/‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å üôÇ",
                moodGreat: "‡§Æ‡•à‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡§æ/‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å! üòä",
                topicAnxiety: "‡§Æ‡•Å‡§ù‡•á ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§∏‡•á ‡§ú‡•Ç‡§ù‡§®‡§æ ‡§™‡§°‡§º ‡§∞‡§π‡§æ ‡§π‡•à",
                topicDepression: "‡§Æ‡•à‡§Ç ‡§â‡§¶‡§æ‡§∏ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡§æ/‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å",
                topicSleep: "‡§Æ‡•Å‡§ù‡•á ‡§∏‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç ‡§™‡§∞‡•á‡§∂‡§æ‡§®‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à",
                topicStress: "‡§Æ‡•à‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§§‡§®‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§π‡•Ç‡§Å"
            },
            bn: {
                tagline: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶®‡¶∏‡¶ø‡¶ï ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ",
                langCode: "‡¶¨‡¶æ‡¶Ç",
                placeholder: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®... ‡¶Ü‡¶Æ‡¶ø ‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø üíú",
                moodVerySad: "‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶ú ‡¶ñ‡ßÅ‡¶¨ ‡¶Æ‡¶® ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™ ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡¶õ‡¶ø üò¢",
                moodSad: "‡¶Ü‡¶Æ‡¶ø ‡¶≠‡¶æ‡¶≤‡ßã ‡¶®‡ßá‡¶á, ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Æ‡¶® ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™ üòî",
                moodNeutral: "‡¶Ü‡¶Æ‡¶ø ‡¶†‡¶ø‡¶ï‡¶†‡¶æ‡¶ï ‡¶Ü‡¶õ‡¶ø üòê",
                moodGood: "‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶ú ‡¶¨‡ßá‡¶∂ ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡¶õ‡¶ø üôÇ",
                moodGreat: "‡¶Ü‡¶Æ‡¶ø ‡¶Ö‡¶®‡ßá‡¶ï ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡¶õ‡¶ø! üòä",
                topicAnxiety: "‡¶Ü‡¶Æ‡¶ø ‡¶â‡¶¶‡ßç‡¶¨‡ßá‡¶ó‡ßá ‡¶≠‡ßÅ‡¶ó‡¶õ‡¶ø",
                topicDepression: "‡¶Ü‡¶Æ‡¶ø ‡¶¨‡¶ø‡¶∑‡¶£‡ßç‡¶£ ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡¶õ‡¶ø",
                topicSleep: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ò‡ßÅ‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá",
                topicStress: "‡¶Ü‡¶Æ‡¶ø ‡¶Ö‡¶®‡ßá‡¶ï ‡¶ö‡¶æ‡¶™‡ßá ‡¶Ü‡¶õ‡¶ø"
            }
        };

        // ==========================================
        // CHATBOT RESPONSES
        // ==========================================
        const responses = {
            greetings: [
                "Hello! I'm really glad you're here. üíú How are you feeling today?",
                "Hi there! Welcome to this safe space. I'm here to listen. What's on your mind?",
                "Hey! It takes courage to reach out. I'm here for you. How can I support you today?"
            ],
            // anxiety: [
            //     "I hear you, and anxiety can feel really overwhelming. üíô Let's work through this together. Can you tell me what's triggering these anxious feelings?",
            //     "Anxiety is tough, but you're not alone. Let's try a grounding technique: Name 5 things you can see around you right now.",
            //     "I understand anxiety can be exhausting. Would you like to try a breathing exercise together? It can really help calm your nervous system."
            // ],
            // depression: [
            //     "I'm really sorry you're going through this. Depression can make everything feel heavy. üíú What's been the hardest part lately?",
            //     "Thank you for sharing that with me. When we're depressed, our brain tells us lies. But you're not alone right now. I'm here.",
            //     "I hear you. Even reaching out like this is a brave step. Would you like to talk about what's been weighing on you?"
            // ],
            // sleep: [
            //     "Sleep troubles can really affect how we feel. üåô Are you having trouble falling asleep or staying asleep?",
            //     "Racing thoughts at night are so frustrating. Try writing down your worries before bed - it helps tell your brain 'I'll deal with these tomorrow.'",
            //     "I understand how exhausting poor sleep is. A consistent bedtime routine can really help. Would you like some tips?"
            // ],
            // stress: [
            //     "Stress can pile up until it feels unbearable. Let's break it down together. üí™ What's the biggest stressor you're dealing with?",
            //     "You're carrying a lot right now. It's okay to set boundaries and say no. What's one thing you could let go of?",
            //     "When we're stressed, our body holds tension. Have you tried taking some deep breaths? I can guide you through it."
            // ],
            // crisis: [
            //     "I'm really concerned about you and I want you to be safe. üíú Please consider calling 14416 - they're trained counsellors who can help right now.",
            //     "Your pain is real, and you deserve support. Please reach out to the helpline 14416. They're available 24/7 and they care.",
            //     "I hear you, and I'm worried. You matter. Please call 14416 to talk to someone who can help you through this."
            // ],
            // default: [
            //     "I hear you. Tell me more about what you're experiencing. Sometimes just expressing our thoughts helps.",
            //     "Thank you for sharing that with me. How long have you been feeling this way?",
            //     "That sounds challenging. I'm here to listen. What would be most helpful for you right now?",
            //     "I appreciate you opening up. Remember, there's no judgment here. What else is on your mind?"
            // ],
            // positive: [
            //     "That's wonderful to hear! üåü It's important to acknowledge the good moments too. What's contributing to this positive feeling?",
            //     "I'm so happy you're feeling good! What's something that brought you joy today?",
            //     "That's great! Celebrating the good days is just as important. Keep nurturing what makes you feel this way! üíú"
            // ]
        };

        const keywords = {
            greetings: ['hello', 'hi', 'hey', 'good morning', 'good evening', 'good afternoon'],
            anxiety: ['anxious', 'anxiety', 'worried', 'worry', 'nervous', 'panic', 'scared', 'fear'],
            depression: ['depressed', 'depression', 'sad', 'hopeless', 'worthless', 'empty', 'down', 'unhappy'],
            sleep: ['sleep', 'insomnia', 'tired', 'exhausted', 'awake', 'nightmare', 'rest'],
            stress: ['stress', 'stressed', 'pressure', 'overwhelm', 'burnout', 'overworked'],
            crisis: ['suicide', 'kill myself', 'end it', 'don\'t want to live', 'hurt myself', 'self harm'],
            positive: ['good', 'great', 'happy', 'better', 'fine', 'okay', 'wonderful', 'amazing']
        };

        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================
        function getCurrentTime() {
            return new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }

        async function getRandomResponse(category, userMessage = '') {
            console.log('Error calling Gemini proxy:');
            // If there is a predefined response list for the category and it's non-empty, return one.
            const arr = responses[category];
            if (Array.isArray(arr) && arr.length > 0) {
                return arr[Math.floor(Math.random() * arr.length)];
            }

            // No predefined response - fall back to Gemini (server proxy) to generate a reply.
            // We call a secure backend endpoint at /api/gemini which will forward the request to
            // the real Gemini API using a server-side API key. This keeps the key out of the browser.
            try {
                console.error('Error calling Gemini proxy:');
                const reply = await fetchGeminiResponse(userMessage || category);
                // If the server returns something useful, return it; otherwise use default fallback.
                if (reply && typeof reply === 'string' && reply.trim().length > 0) {
                    return reply;
                }
            } catch (err) {
                console.error('Error calling Gemini proxy:', err);
            }

            // Final fallback to local default responses if everything else fails
            const fall = responses.default || ["I'm here ‚Äî tell me more."];
            return fall[Math.floor(Math.random() * fall.length)];
        }

        function analyzeMessage(message) {
            const lower = message.toLowerCase();
            
            // Check crisis first
            for (const word of keywords.crisis) {
                if (lower.includes(word)) {
                    showEmergencyModal();
                    return 'crisis';
                }
            }
            
            for (const [category, words] of Object.entries(keywords)) {
                for (const word of words) {
                    if (lower.includes(word)) {
                        return category;
                    }
                }
            }
            
            return 'default';
        }

        // ==========================================
        // GEMINI / LLM PROXY CALL
        // ==========================================
        // NOTE: This assumes you have a server-side proxy at /api/gemini that accepts
        // POST { prompt: '...' } and returns { reply: '...' }. See README for an example.
        async function fetchGeminiResponse(prompt) {
            if (!prompt || !prompt.trim()) return '';

            // show typing indicator while waiting
            showTypingIndicator();

            try {
                // When the page is opened directly via file://, a relative path like
                // '/api/gemini' resolves to file:///api/gemini and fails. Detect file://
                // and use the local proxy URL (http://localhost:3000) by default.
                const defaultProxy = 'https://heybuddy-g8ar.onrender.com';
                const origin = (window.location.protocol === 'file:') ? defaultProxy : window.location.origin;
                const endpoint = 'https://heybuddy-g8ar.onrender.com/api/gemini';

                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt })
                });

                removeTypingIndicator();

                if (!res.ok) {
                    console.error('Gemini proxy returned non-OK status', res.status);
                    return '';
                }

                const data = await res.json();
                // The proxy should return { reply: '...' }
                return (data && data.reply) ? data.reply : '';
            } catch (err) {
                removeTypingIndicator();
                console.error('Error fetching Gemini response', err);
                return '';
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toast.className = 'toast ' + type;
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==========================================
        // DROPDOWN FUNCTIONS
        // ==========================================
        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            const isActive = dropdown.classList.contains('active');
            
            // Close all dropdowns
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
            
            if (!isActive) {
                dropdown.classList.add('active');
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
            }
        });

        // ==========================================
        // THEME FUNCTIONS
        // ==========================================
        function changeTheme(theme) {
            if (theme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                theme = prefersDark ? 'dark' : 'light';
            }
            
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('heybuddy-theme', theme);
            currentTheme = theme;
            
            // Update active states
            document.querySelectorAll('[data-theme]').forEach(el => {
                el.classList.toggle('active', el.getAttribute('data-theme') === theme);
            });
            
            showToast('Theme changed!');
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
        }

        // ==========================================
        // LANGUAGE FUNCTIONS
        // ==========================================
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('heybuddy-lang', lang);
            document.documentElement.setAttribute('data-lang', lang);
            
            const t = translations[lang];
            
            // Update UI elements
            document.getElementById('taglineText').textContent = t.tagline;
            document.getElementById('currentLangText').textContent = t.langCode;
            document.getElementById('messageInput').placeholder = t.placeholder;
            
            // Update flag
            const flags = { en: 'üá¨üáß', hi: 'üáÆüá≥', bn: 'üáÆüá≥' };
            document.getElementById('currentLangFlag').textContent = flags[lang];
            
            // Update active states
            document.querySelectorAll('[data-lang]').forEach(el => {
                el.classList.toggle('active', el.getAttribute('data-lang') === lang);
            });
            
            showToast('Language changed!');
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
        }

        // ==========================================
        // MESSAGE FUNCTIONS
        // ==========================================
        function hideWelcomeScreen() {
            const ws = document.getElementById('welcomeScreen');
            if (ws) ws.style.display = 'none';
        }

        function addMessage(content, isUser = false) {
            hideWelcomeScreen();
            
            const container = document.getElementById('messagesContainer');
            const div = document.createElement('div');
            div.className = `message ${isUser ? 'user' : 'bot'}`;
            
            div.innerHTML = `
                <div class="message-avatar">
                    <i class="fas ${isUser ? 'fa-user' : 'fa-robot'}"></i>
                </div>
                <div>
                    <div class="message-content">${content}</div>
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            const div = document.createElement('div');
            div.className = 'typing-indicator';
            div.id = 'typingIndicator';
            
            div.innerHTML = `
                <div class="message-avatar" style="background: var(--gradient); color: white;">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            `;
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            addMessage(message, true);
            input.value = '';
            
            isTyping = true;
            showTypingIndicator();
            
            setTimeout(async () => {
                removeTypingIndicator();
                const category = analyzeMessage(message);
                // getRandomResponse may call Gemini proxy if there's no local response
                const response = await getRandomResponse(category, message);
                addMessage(response);
                isTyping = false;
            }, 1000 + Math.random() * 1000);
        }

        function sendSuggestion(text) {
            document.getElementById('messageInput').value = text;
            sendMessage();
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        // ==========================================
        // MOOD & TOPIC FUNCTIONS
        // ==========================================
        function selectMood(emoji, mood) {
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            const t = translations[currentLanguage];
            const moodKey = 'mood' + mood.charAt(0).toUpperCase() + mood.slice(1);
            const message = t[moodKey] || `I'm feeling ${mood} ${emoji}`;
            
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function quickTopic(topic) {
            const t = translations[currentLanguage];
            const topicKey = 'topic' + topic.charAt(0).toUpperCase() + topic.slice(1);
            const message = t[topicKey] || `I want to talk about ${topic}`;
            
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        // ==========================================
        // MODAL FUNCTIONS
        // ==========================================
        function showEmergencyModal() {
            document.getElementById('emergencyModal').classList.add('active');
        }

        function closeEmergencyModal() {
            document.getElementById('emergencyModal').classList.remove('active');
        }

        function showSettingsModal() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
            showToast('Settings saved!');
        }

        function startBreathingExercise() {
            document.getElementById('breathingModal').classList.add('active');
        }

        function closeBreathingModal() {
            document.getElementById('breathingModal').classList.remove('active');
            stopBreathingExercise();
        }

        function closeModalOnOverlay(e, modalId) {
            if (e.target.classList.contains('modal-overlay')) {
                document.getElementById(modalId).classList.remove('active');
                if (modalId === 'breathingModal') stopBreathingExercise();
            }
        }

        // ==========================================
        // BREATHING EXERCISE
        // ==========================================
        function toggleBreathingExercise() {
            const btn = document.getElementById('breathingBtn');
            const circle = document.getElementById('breathingCircle');
            
            if (!isBreathing) {
                isBreathing = true;
                btn.textContent = 'Stop Exercise';
                runBreathingCycle();
            } else {
                stopBreathingExercise();
            }
        }

        function runBreathingCycle() {
            const circle = document.getElementById('breathingCircle');
            const phases = [
                { text: 'Breathe In...', class: 'inhale', duration: 4000 },
                { text: 'Hold...', class: 'hold', duration: 4000 },
                { text: 'Breathe Out...', class: 'exhale', duration: 4000 },
                { text: 'Hold...', class: '', duration: 2000 }
            ];
            
            let phase = 0;
            
            function nextPhase() {
                if (!isBreathing) return;
                
                const p = phases[phase];
                circle.textContent = p.text;
                circle.className = 'breathing-circle ' + p.class;
                
                phase = (phase + 1) % phases.length;
                breathingInterval = setTimeout(nextPhase, p.duration);
            }
            
            nextPhase();
        }

        function stopBreathingExercise() {
            isBreathing = false;
            clearTimeout(breathingInterval);
            document.getElementById('breathingBtn').textContent = 'Start Exercise';
            document.getElementById('breathingCircle').textContent = 'Ready';
            document.getElementById('breathingCircle').className = 'breathing-circle';
        }

        // ==========================================
        // CLEAR CHAT
        // ==========================================
        function clearChat() {
            if (confirm('Are you sure you want to clear the chat?')) {
                const container = document.getElementById('messagesContainer');
                container.innerHTML = `
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-icon">
                            <i class="fas fa-hand-holding-heart"></i>
                        </div>
                        <h2>Hey Buddy! üëã</h2>
                        <p>I'm here to listen and support you through difficult moments. Remember, you're not alone.</p>
                        <div class="welcome-helpline">
                            <i class="fas fa-phone-alt"></i>
                            <div class="helpline-info">
                                <div class="number">14416</div>
                                <div class="text">Talk to a counsellor anytime</div>
                            </div>
                        </div>
                        <div class="welcome-features">
                            <div class="welcome-feature">
                                <i class="fas fa-shield-heart"></i>
                                <p>Safe Space</p>
                            </div>
                            <div class="welcome-feature">
                                <i class="fas fa-lock"></i>
                                <p>Private & Secure</p>
                            </div>
                            <div class="welcome-feature">
                                <i class="fas fa-clock"></i>
                                <p>24/7 Available</p>
                            </div>
                        </div>
                    </div>
                `;
                showToast('Chat cleared!');
            }
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {
            // Apply saved settings
            if (currentTheme) {
                changeTheme(currentTheme);
            }
            if (currentLanguage) {
                changeLanguage(currentLanguage);
            }
        });
    </script>
</body>
</html>